<% canonical(new_lesson_url) %>
<% content_for :meta_title, "Koach & Co | Votre séance de sport personnalisée" %>
<% content_for :meta_description, "Créez votre séance idéale et adaptée vos contraintes en quelques clics ! Sélectionnez une activité sportive, une date, une heure, un lieu en extérieur et invitez vos amis à y participer." %>

<div class="container mb-3" data-controller="mapbox" data-mapbox-target="container">
  <h1 class="our-concept-title text-center my-5">PROGRAMMEZ VOTRE PROCHAINE SÉANCE</h1>
  <%= simple_form_for @lesson do |f| %>
    <div class="row">
      <div class="col-12 col-md-4">
        <div class="card-red card-new-lesson mt-3 mt-md-0 p-4 text-center" style="background-image: url(<%= asset_path 'backgroundblue1.png' %>);">
          <h2><em>SPORT</em></h2>
          <%= f.input :sport_type, collection: Lesson::SPORTS, label: false, include_blank: "Choisissez l'activité" %>
          <div class="p-2 sports-description">
            <p class="text-gray">Sélectionnez une activité pour afficher les caractéristiques de la séance</p>
            <p class="mb-0 text-gray"><span class="text-coral text-xbold">Descriptif</span> : <span>...</span></p>
            <p class="mb-0 text-gray"><span class="text-coral text-xbold">Niveau d'intensité</span> : <span>...</span></p>
            <p class="mb-0 text-gray"><span class="text-coral text-xbold">Durée</span> : <span>...</span></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card-red card-new-lesson mt-3 mt-md-0 p-4 text-center" style="background-image: url(<%= asset_path 'backgroundblue2.png' %>);">
          <h2><em>DATE & LIEU</em></h2>
          <%= f.input :date, as: :string, label: false, placeholder: "Choisissez la date et l'heure", input_html: { class: "datepicker" } %>
          <%= text_field_tag :address, nil, placeholder: "Renseignez l'adresse postale exacte...", id: 'location_name', class:'new-address-input', 'data-mapbox-target' => 'address', 'data-action' => "click->mapbox#addressSelect" %>
          <div class="mb-3"></div>
          <button type="button" class="btn btn-kotch btn-light-blue w-100 btn-modal" data-toggle="modal" data-target=".bd-example-modal-lg">Voir les lieux disponibles sur la carte</button>
          <%= f.association :location, collection: @locations, label_method: :name, value_method: :id, label: false, input_html: { id: "location-collection", class: "mt-3", 'data-mapbox-target' => 'collection', disabled: true } %>

          <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" data-mapbox-target="modal">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div id="map"
                 style="width: 100%; height: 600px;"
                 data-markers="<%= @markers.to_json %>"
                 data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card-red card-new-lesson mt-3 mt-md-0 p-4 text-center" style="background-image: url(<%= asset_path 'backgroundblue1.png' %>);">
          <h2><em>INVITEZ VOS AMIS</em></h2>
          <% if current_user.coach %>
            <em class="text-blue">Réservé aux clients</em>
          <% else %>
            <%= select_tag "friends", options_from_collection_for_select(
              @friends, :id, :full_name), multiple: true,
              class: 'select2' %>
            <div class="my-2 font-weight-bold text-white italic input-separator">ET / OU</div>
            <%= text_area_tag :emails,
              nil,
              placeholder: "Renseignez les adresses email de vos amis pas encore inscrits et séparez-les par une virgule",
              class: 'p-2 many-emails-input' %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="text-center mt-0 mt-md-4">
      <%= f.submit "VALIDEZ VOTRE SÉANCE", class:'btn btn-kotch btn-blue btn-md-lg mt-4' %>
    </div>
  <% end %>
</div>

<!-- <script>
  modalBtn = document.querySelector('.btn-modal');
  modal = document.querySelector('.modal');
  locationCollection = document.querySelector('#location-collection');

  modalBtn.addEventListener('click', () => {
    buttons = document.querySelectorAll('.btn-location');
    console.log(locationCollection);
    console.log(mocal);
    console.log(buttons);
    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        locationID = button.dataset.id;
        modal.style.display = "none";
        locationCollection.value = locationID;
      });
    });
  });
</script> -->
