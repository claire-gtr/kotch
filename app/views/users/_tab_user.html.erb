<div class="card-blue profile-box profile-box-bg">
  <ul class="nav nav-tabs justify-content-between rounded-top-right rounded-top-left" role="tablist">
    <li class="nav-item">
      <a class="active btn btn-big rounded-0" data-toggle="tab" href="#tabs-1" role="tab" id="tab-1">Séance à venir</a>
    </li>
    <li class="nav-item">
      <a class="btn btn-big rounded-0" data-toggle="tab" href="#tabs-2" role="tab" id="tab-2">Historique des séances</a>
    </li>
    <li class="nav-item">
      <a class="btn btn-big rounded-0" data-toggle="tab" href="#tabs-3" role="tab" id="tab-3">Mon abonnement / Mes achats</a>
    </li>
  </ul><!-- Tab panes -->
  <div class="tab-content p-3">
    <div class="tab-pane active" id="tabs-1" role="tabpanel">
      <table class="w-100 text-center">
        <thead class="w-100">
          <tr>
            <th>SPORT</th>
            <th>DATE</th>
            <th>HEURE</th>
            <th>LIEU</th>
            <th>STATUT</th>
            <th>PARTICIPANTS</th>
            </tr>
        </thead>
        <tbody>
          <% if @bookings_in_future.any? %>
            <% @bookings_in_future.each do |booking| %>
              <tr>
                <td class='py-2'><%= booking.lesson.sport_type %></td>
                <td class='py-2'><%= booking.lesson.date.strftime('%d/%m/%Y') %></td>
                <td class='py-2'><%= booking.lesson.date.strftime('%H:%M') %></td>
                <td class='py-2'><%= booking.lesson.location.name %></td>
                <td class='py-2'>
                  <% if booking.lesson.status == "pending" %>
                    En attente
                  <% else %>
                    <%= booking.lesson.status %>
                  <% end %>
                </td>
                <td class='py-2'>
                  <button type="button" class="btn-plus" data-toggle="modal" data-target="#modal1-<%= booking.lesson.id %>"><i class="fas fa-plus-circle fa-xs"></i></button>
                </td>
              </tr>
              <!-- Modal -->
              <div class="modal fade" id="modal1-<%= booking.lesson.id %>" tabindex="-1" role="dialog" aria-labelledby="participantsModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content participants-modal">
                    <div class="modal-header d-flex">
                      <h3 class="modal-title" id="participantsModalLabel"><%= booking.lesson.sport_type.upcase %></h3>
                      <p><i><%= booking.lesson.date.strftime("%d/%m/%Y") %></i></p>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <h5 class="my-3">COACH</h5>
                      <% if  booking.lesson.user %>
                        <p class="text-blue text-condensed"><%= booking.lesson.user.first_name if booking.lesson.user_id%></p>
                      <% else %>
                        <p class="text-blue">Il n'y a pas encore de coach</p>
                      <% end %>
                      <h5 class="my-3">PARTICIPANTS</h5>
                      <% booking.lesson.bookings.each do |booking| %>
                        <span>
                          <div class="bullet">• &nbsp</div>
                          <ul class="d-flex justify-content-between">
                            <li><%= booking.user.first_name %> <%= booking.user.last_name.upcase %></li>
                          </ul>
                        </span>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
              <!-- End modal -->
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="tab-pane" id="tabs-2" role="tabpanel">
      <table class="w-100 text-center">
        <thead class="w-100">
          <tr>
            <th>SPORT</th>
            <th>DATE</th>
            <th>HEURE</th>
            <th>LIEU</th>
            <th>STATUT</th>
            <th>COACH</th>
            </tr>
        </thead>
        <tbody>
          <% if @bookings_in_past.any? %>
            <% @bookings_in_past.each do |booking| %>
              <tr>
                <td class="py-2"><%= booking.lesson.sport_type %></td>
                <td class="py-2"><%= booking.lesson.date.strftime('%d/%m/%Y') %></td>
                <td class="py-2"><%= booking.lesson.date.strftime('%H:%M') %></td>
                <td class="py-2"><%= booking.lesson.location.name %></td>
                <td class="py-2">
                  <% if booking.lesson.status == "pending" %>
                    En attente
                  <% elsif booking.lesson.status == "canceled" %>
                    Annulée
                  <% else %>
                    <%= booking.lesson.status.capitalize %>
                  <% end %>
                </td>
                <td class="py-2">
                  <%= booking.lesson.user.first_name if booking.lesson.user_id%>
                  <button type="button" class="btn-plus" data-toggle="modal" data-target="#modal-past-bookings-<%= booking.lesson.id %>"><i class="fas fa-plus-circle fa-xs"></i></button>
                </td>
              </tr>
              <!-- Modal -->
              <div class="modal fade" id="modal-past-bookings-<%= booking.lesson.id %>" tabindex="-1" role="dialog" aria-labelledby="participantsModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content participants-modal">
                    <div class="modal-header d-flex">
                      <h3 class="modal-title" id="participantsModalLabel"><%= booking.lesson.sport_type.upcase %></h3>
                      <p><i><%= booking.lesson.date.strftime("%d/%m/%Y") %></i></p>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <h5 class="my-3">PARTICIPANTS</h5>
                      <% booking.lesson.bookings.each do |booking| %>
                        <span>
                          <div class="bullet">• &nbsp</div>
                          <ul class="d-flex justify-content-between">
                            <li><%= booking.user.first_name %> <%= booking.user.last_name.upcase %></li>
                          </ul>
                        </span>
                      <% end %>
                      <h5 class="my-3">ÉLÉMENTS TRAVAILLÉS PENDANT LA SÉANCES</h5>
                      <%= simple_form_for booking.lesson, url: focus_lesson_path(booking.lesson), method: :get do |f| %>
                        <%= f.input :focus, label: false %>
                      <%= f.submit "Enregistré les éléments travaillés", class:'btn btn-kotch btn-ghost' %>
                      <% end %>
                      </div>
                  </div>
                </div>
              </div>
              <!-- End modal -->
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="tab-pane" id="tabs-3" role="tabpanel">
      <% if current_user.subscription && current_user.subscription.stripe_id %>
        <div class="text-center">
          <p class="text-blue mt-5">Vous êtes actuellement abonné(e) au plan <%= current_user.subscription.nickname %>.</p>
          <form action="/customer_portal_sessions" method="POST">
            <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
            <button class="btn btn-kotch btn-red">Gérer mon abonnement</button>
          </form>
        </div>
      <% else %>
        <div class="text-center">
          <p class="text-blue">Vous n'avez pas d'abonnement à Koach.</p>
          <%= link_to "Je m'abonne", offers_path, data: {turbolinks: "false"}, class:'btn btn-red btn-kotch'  %>
        </div>
      <% end %>
      <div class="text-center">
        <% if current_user.credit_count > 0 %>
          <p class="text-blue mt-5">Vous avez <%= current_user.credit_count %> crédits hors abonnement.</p>
        <% else %>
          <p class="text-blue mt-5">Vous n'avez pas de séances hors abonnement.</p>
        <% end %>
      </div>
      <div class="text-center">
        <% if current_user.promo_code_used == false %>
          <p class="text-blue mt-5">Entrer un code promotionnel :</p>
          <%= simple_form_for current_user, url: use_a_promo_code_path(current_user), method: :patch do |f| %>
            <%= text_field_tag :name, nil, label: "Nom du code", class:'text-uppercase' %>
            <br>
            <%= submit_tag "Utiliser ce code promo", class:'btn btn-red btn-kotch mt-2' %>
          <% end %>
        <% else %>
          <p class="text-blue mt-5">Vous avez déjà utilisé un code promotionnel.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>


<%#
REFERENCES FOR CSS CLASSES

.profile-box, .profile-box-bg                         => pages/_profile.scss
%>

<script>
  tab1 = document.querySelector('#tab-1');
  tab2 = document.querySelector('#tab-2');
  tab3 = document.querySelector('#tab-3');

  window.addEventListener('load', function () {
    <% if @tab.present? && (@tab == 'tab-3') %>
      tab3.click();
    <% end %>
  })
</script>
